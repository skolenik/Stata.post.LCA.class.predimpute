<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Imputation of Latent Classes post gsem</title>
    <meta charset="utf-8" />
    <meta name="author" content="Stas Kolenikov" />
    <meta name="date" content="2024-08-02" />
    <script src="StataConf2024-Kolenikov-postLCA_files/header-attrs-2.27/header-attrs.js"></script>
    <link href="StataConf2024-Kolenikov-postLCA_files/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="StataConf2024-Kolenikov-postLCA_files/tabwid-1.1.3/tabwid.js"></script>
    <link rel="stylesheet" href="styles.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: title-slide
background-image: url(images/cover-1.png)
background-size: cover

# Imputation of Latent Classes after Latent Class Analysis

&lt;br&gt; 
&lt;br&gt;  
#### Hacking Stata MI toolset


Stata Conference -- August 2, 2024

Stas Kolenikov, NORC

---
class: primary, inverse
background-image: url(images/section-1.png)
background-size: cover

# Latent Class Analysis  


---
.slide-header[LCA : .strong[Main idea]]
### Latent Class Analysis: Discrete Random Variable(s) 

.strong[LCA]
- Discrete latent variable(s)
    + mixture models (`fmm`) are close relatives appropriate for single outcome
- Discrete outcomes
- "Classic" quantitative social sciences: 
  sophisticated log-linear modeling of the full contingency table
- Stata implementation: variation of `gsem`

---
.slide-header[LCA : .strong[Example]]
### Latent Class Analysis: Example

Three binary variables, `\(2^3=8\)` distinct outcomes, some (secret so far)
model-based probabilities in the full 3-way table:



&lt;div class="tabwid"&gt;&lt;style&gt;.cl-0123eec8{}.cl-0112dc46{font-family:'Roboto Light';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0112dc78{font-family:'Roboto Light';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0118e974{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0118e97e{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:2pt;padding-right:2pt;line-height: 1;background-color:transparent;}.cl-01191818{width:1.625in;background-color:rgba(173, 163, 157, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-01191822{width:1.625in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-01191823{width:1.625in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}&lt;/style&gt;&lt;table data-quarto-disable-processing='true' class='cl-0123eec8'&gt;&lt;thead&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;th class="cl-01191818"&gt;&lt;p class="cl-0118e974"&gt;&lt;span class="cl-0112dc46"&gt;y1&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-01191818"&gt;&lt;p class="cl-0118e974"&gt;&lt;span class="cl-0112dc46"&gt;y2&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-01191818"&gt;&lt;p class="cl-0118e974"&gt;&lt;span class="cl-0112dc46"&gt;y3&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-01191818"&gt;&lt;p class="cl-0118e974"&gt;&lt;span class="cl-0112dc46"&gt;Prob&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191822"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191822"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191822"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191822"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.096&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.084&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.104&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.116&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.224&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.096&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.176&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01191823"&gt;&lt;p class="cl-0118e97e"&gt;&lt;span class="cl-0112dc78"&gt;0.104&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;

---
.slide-header[LCA : .strong[Three-var example]]
### Latent Class Analysis: Single class solution

One-class solution / marginal probabilities:

$$
\mathbb{P}[y_1=1]=0.6, \mathbb{P}[y_2=1]=0.5, \mathbb{P}[y_3=1]=0.4
$$
Three-way probabilities:

&lt;div class="tabwid"&gt;&lt;style&gt;.cl-014b3320{}.cl-013d890a{font-family:'Roboto Light';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-013d891e{font-family:'Roboto Light';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0142580e{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-01425818{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:2pt;padding-right:2pt;line-height: 1;background-color:transparent;}.cl-0142861c{width:1.3in;background-color:rgba(173, 163, 157, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-01428626{width:1.3in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-01428627{width:1.3in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(0, 0, 0, 1.00);border-right: 1pt solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}&lt;/style&gt;&lt;table data-quarto-disable-processing='true' class='cl-014b3320'&gt;&lt;thead&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;th class="cl-0142861c"&gt;&lt;p class="cl-0142580e"&gt;&lt;span class="cl-013d890a"&gt;y1&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-0142861c"&gt;&lt;p class="cl-0142580e"&gt;&lt;span class="cl-013d890a"&gt;y2&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-0142861c"&gt;&lt;p class="cl-0142580e"&gt;&lt;span class="cl-013d890a"&gt;y3&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-0142861c"&gt;&lt;p class="cl-0142580e"&gt;&lt;span class="cl-013d890a"&gt;Prob&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-0142861c"&gt;&lt;p class="cl-0142580e"&gt;&lt;span class="cl-013d890a"&gt;Prob(LCA 1)&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428626"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428626"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428626"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428626"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.096&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428626"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.12&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.084&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.08&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.104&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.12&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.116&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.08&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.224&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.18&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.096&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.12&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.176&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.18&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.104&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-01428627"&gt;&lt;p class="cl-01425818"&gt;&lt;span class="cl-013d891e"&gt;0.12&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;

Non-centrality: 0.03702 per observation;
Pearson `\(\chi^2(4)\)` will reject accordingly.

---
.slide-header[LCA : .strong[Three-var example]]
### Latent Class Analysis: Single class solution

&lt;img src=images/Stata_gsem_lca1_run.png style="width:671px;height:500px;"&gt;

---
.slide-header[LCA : .strong[Three-var example]]
### Latent Class Analysis: Single class solution

&lt;img src=images/Stata_gsem_lca1_estat.png style="width:655px;height:500px;"&gt;

---
.slide-header[LCA : .strong[Three-var example]]
### Latent Class Analysis: Two class solution

Two-class solution:

$$
\mathbb{P}[y_1=1|C=1]=0.4, \mathbb{P}[y_2=1|C=1]=0.6, \mathbb{P}[y_3=1|C=1]=0.6
$$
$$
\mathbb{P}[y_1=1|C=2]=0.8, \mathbb{P}[y_2=1|C=2]=0.4, \mathbb{P}[y_3=1|C=2]=0.2
$$
$$
\mathbb{P}[C=1]=0.5, \mathbb{P}[C=2]=0.5
$$


---
.slide-header[LCA : .strong[Three-var example]]
### Latent Class Analysis: Two class solution

&lt;img src=images/Stata_gsem_lca2.png style="width:506;height:500px;"&gt;

---
class: primary, inverse
background-image: url(images/section-1.png)
background-size: cover

# Class Predictions


---
.slide-header[LCA postestimation : .strong[Class prediction]]
### What if you want to use classes in subsequent analyses?

- Summarize variables not in the model by class
- Use classes as predictors in downstream models

.strong[You... don't get them]

- Classes are latent variables: you can never be sure about class membership
- Any prediction of the class labels is subject to a (prediction) error
- Subsequent use of single predictions would lead to measurement error biases

---
.slide-header[LCA postestimation : .strong[Class prediction]]
### Posterior probablity predictions

You can get `\(\hat p[C|\mbox{pattern of }y] = \frac{\hat p[y|С] \times \hat p[C]}{\sum_c \hat p[y|c] \times \hat p[c]}\)`:

&lt;img src=images/Stata_lca2_posterior.png style="width:583;height:460px;"&gt;

---
.slide-header[LCA postestimation : .strong[Class prediction]]
### What do we do???

Is there a practical solution to the problem of class prediction after LCA?

---
class: primary, inverse
background-image: url(images/section-1.png)
background-size: cover

# Multiple imputation


---
.slide-header[Multiple Imputation : .strong[Big idea]]

## Multiple imputation is the worst missing data method except all others that have been tried 

### (Winston Churchill The Statistician)

---
.slide-header[Multiple Imputation : .strong[Big idea]]
### MI algorithm

1. Formulate a multivariate predictive model of the world (including outcomes)
2. For `\(m=1, \ldots, M\)`:
    1. Obtain estimates `\(\hat{\beta}\)` and standard errors `\(s(\hat{\beta})\)`
    2. Predict from "model + parameter uncertainty" `\(\hat{\beta} + z \times s(\hat{\beta})\)`
    3. Add noise from `\(y \sim f(y|\hat{\beta} + z \times s(\hat{\beta}))\)`
    4. Refit the model until some sort of distribution convergence
    5. Retain the last set of imputations `\(Y^{(m)}\)`
3. Estimate the model of substantive interest `\(\theta^{(m)}=g(Y^{(m)})\)` for each `\(m\)`.
4. Overall estimate: `\(\theta_{\rm MI}^{(M)} = \frac1M \sum_{m=1}^M \theta^{(m)}\)`
5. Overall variance (Rubin's formula): 

$$
T=\bar U + (1+1/M) B, \,
\bar U = \frac{1}{M} \sum_{m=1}^M v^{(m)}\bigl[\theta^{(m)}\bigr]
$$

$$
B = \frac{1}{M-1} \sum_{m=1}^M \bigl(\theta^{(m)} - \bar \theta\bigr) \bigl(\theta^{(m)} - \bar \theta\bigr)'
$$

---
.slide-header[Multiple Imputation : .strong[Big idea]]
### Worthwhile references

- Original: [Rubin (1977)](https://doi.org/10.1198/000313004X6355)
- Review: [after 18+ years Rubin (1996)](https://www.tandfonline.com/doi/abs/10.1080/01621459.1996.10476908)
- Most practical: van Buuren [FIMD 2nd edn](https://stefvanbuuren.name/fimd) (2018)
- Stata resources:
    * [MI manual](https://www.stata.com/manuals/mi.pdf)
    * SJ MI diagnostics: [Eddings and Marchenko (2012)](https://journals.sagepub.com/doi/10.1177/1536867X1201200301)


---
class: primary, inverse
background-image: url(images/section-1.png)
background-size: cover

# Hacking Stata MI engine


---
.slide-header[Stata MI : .strong[Custrom programming]]
### MI for the people

1. Study MI manual.
2. Study `help mi_technical`.
3. Write your custom imputation code (Stas likes `mi set wide`).
4. Make sure it satisfies `mi` internal standards and expectations: `mi update`.
5. Cross fingers and run `mi estimate: whatever`.

Turns out there is more: Stata freaks out about omitted entries in `e(b)`,
zero variances, and other oddities.

---
.slide-header[Stata MI : .strong[User-written MI]]
### `postlca_class_predpute`

&lt;img src=images/Stata_lca2_predpute.png style="width:585;height:500px;"&gt;

---
.slide-header[Stata MI : .strong[User-written MI]]
### `mi estimate`

&lt;img src=images/Stata_lca2_mi_est_mean.png style="width:556;height:500px;"&gt;

---
.slide-header[Stata MI : .strong[User-written MI]]
### `mi estimate` failures

&lt;img src=images/Stata_lca2_mi_est_fail.png style="width:1066;height:304px;"&gt;

Stas' intuition:

- more of a problem with smaller models
- less of a problem with continuous variables

---
class: primary, inverse
background-image: url(images/section-1.png)
background-size: cover

# More and better work


---
.slide-header[Futher work : .strong[SJ paper]]
### More comprehensive coverage

.strong[Stata Journal (formatted) paper]
- More rigorous methodology overview
- Full documentation of the new command, its options and its use
- Simulations

https://github.com/skolenik/Stata.post.LCA.class.predimpute

---
class: primary
background-image: url(images/questions-1.png)
background-size: cover

# Questions slide 


---
class: inverse
background-image: url(images/thankyou-1.png)
background-size: cover


.thankyou[

# Thank you.
]


.contact[
.strong[Stas Kolenikov]  
Principal Statistician

kolenikov-stas@norc.org   
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
